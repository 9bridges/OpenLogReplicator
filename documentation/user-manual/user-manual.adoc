= User Manual
:author: Adam Leszczyński <aleszczynski@bersler.com>
:revnumber: 1.1.0
:revdate: 2022-03-30
:imagesdir: ./images
:toc: preamble

[frame="none",grid="none"]
|====
a|[.small]#Autor: {author}, version: {revnumber}, date: {revdate}#
|====

This document describes common usage scenarios of OpenLogReplicator.

== Introduction

=== Output

Transactions read from database redo log files can be written in 2 formats:

- JSON
- Protocol buffer

Until the first release is made the format is still subject of changes.

Transaction stream can be sent to:

- Kafka
- Flat file
- Network stream

== Getting started

OpenLogReplicator is essentially a program that reads redo log files created by Oracle database and translates it to JSON messages. To understand the principals it is crucial to know how Oracle database works.

=== Database redo logs

All changes in the database (results of DML commands like INSERT, UPDATE, DELETE) are written to database redo log. If the database redo logs contains commit record – it means that the transaction is committed to the database. Before receiving the commit record – the transaction can be still rolled back – so all changes would be undone like the transaction never happened.

=== Program architecture

OpenLogReplicator consistently reads Oracle redo log files. If possible – it would read online redo logs, but if it is behind – it can also read archived redo logs. It is crucial that it has a physical access to those files. When it is run from a remote host – access through sshfs is enough.

=== Transaction caching

All transactions which are open are cached in memory. They are cache so long, how long they are open. If they are big – the program would need more memory. OpenLogReplicator never writes any additional files to disk beside checkpoint and schema file.

If you shut down OpenLogReplicator and later start again – it would need to go back to the oldest unprocessed transaction location and start reading database redo logs from this position.

=== Schema changes

The current release of OpenLogReplicator supports schema changes. The initial schema of the table(s) is read during startup of the program. Later changes to the schema are tracked.

== Supported Features

OpenLogReplicator basically works a redo log file parser. All information it operates on comes from database redo logs (online or archived). This is a list of information it can read from redo log, parse and sent as JSON message:

- INSERT operation (including multiple row INSERT, but not direct path – INSERT /*+append*/);
- UPDATE operation;
- DELETE operation (including multiple row DELETE).

=== Table parameters

Tables with following parameters are supported:

- null/not null columns;
- invisible columns;
- columns with null and default values;
- up to 1000 columns (database maximum);
- row chaining/migration;
- partial rollbacks (rollback to savepoint);
- partitioned tables;
- tables with rowdependencies.

Transactions that are rolled back are not processed. Transactions are processed as soon as they are committed (not earlier).

=== Column types

List of supported column types (with internal Oracle codes):

- 1 – varchar2/nvarchar2 (list of supported character sets);
- 2 – number/float;
- 12 – date;
- 23 – raw;
- 96 – char/nchar (list of supported character sets);
- 100 – binary_float;
- 101 – binary_double;
- 180 – timestamp;
- 181 – timestamp with time zone.

If a table contains column types which are not supported – “?” value is presented in JSON output.

=== DDL operations

Changes in the schema are supported.

=== Supported Character Sets

OpenLogReplicator supports many character sets which can be used in the source Oracle database.

All character fields are read from the source database in respect to the source character set. The output message always uses Unicode as character encoding and UTF-8 format. OpenLogReplicator does not perform any left-to-right Unicode character replacements.

For test purposes the character set conversion can be disabled. Please check the configuration parameters for details (TODO: link).

Full list of supported character sets is: *AL16UTF16*, *AL32UTF8*, AR8ADOS710, AR8ADOS710T, AR8ADOS720, AR8ADOS720T, AR8APTEC715, AR8APTEC715T, AR8ARABICMACS, AR8ASMO708PLUS, AR8ASMO8X, AR8HPARABIC8T, AR8ISO8859P6, AR8MSWIN1256, AR8MUSSAD768, AR8MUSSAD768T, AR8NAFITHA711, AR8NAFITHA711T, AR8NAFITHA721, AR8NAFITHA721T, AR8SAKHR706, AR8SAKHR707, AR8SAKHR707T, AZ8ISO8859P9E, BG8MSWIN, BG8PC437S, BLT8CP921, BLT8ISO8859P13, BLT8MSWIN1257, BLT8PC775, BN8BSCII, CDN8PC863, CEL8ISO8859P14, CL8ISO8859P5, CL8ISOIR111, CL8KOI8R, CL8KOI8U, CL8MACCYRILLICS, CL8MSWIN1251, D7DEC, D7SIEMENS9780X, DK7SIEMENS9780X, E7DEC, E7SIEMENS9780X, EE8ISO8859P2, EE8MACCES, EE8MACCROATIANS, EE8MSWIN1250, EE8PC852, EEC8EUROASCI, EEC8EUROPA3, EL8DEC, EL8ISO8859P7, EL8MACGREEKS, EL8MSWIN1253, EL8PC437S, EL8PC737, EL8PC851, EL8PC869, ET8MSWIN923, HU8ABMOD, HU8CWI2, I7DEC, I7SIEMENS9780X, IN8ISCII, IS8MACICELANDICS, IS8PC861, IW8ISO8859P8, IW8MACHEBREWS, IW8MSWIN1255, IW8PC1507, JA16EUC, JA16EUCTILDE, JA16EUCYEN, JA16SJIS, JA16SJISTILDE, JA16SJISYEN, JA16VMS, KO16KSC5601, KO16KSCCS, KO16MSWIN949, LA8ISO6937, LA8PASSPORT, LT8MSWIN921, LT8PC772, LT8PC774, LV8PC1117, LV8PC8LR, LV8RST104090, N7SIEMENS9780X, N8PC865, NDK7DEC, NE8ISO8859P10, NEE8ISO8859P4, RU8BESTA, RU8PC855, RU8PC866, S7DEC, S7SIEMENS9780X, SE8ISO8859P3, SF7ASCII, SF7DEC, TH8MACTHAIS, TH8TISASCII, TIMESTEN8, TR8DEC, TR8MACTURKISHS, TR8MSWIN1254, TR8PC857, US7ASCII, US8PC437, *UTF8*, VN8MSWIN1258, VN8VN3, WE8DEC, WE8DG, WE8HP, WE8ISO8859P1, WE8ISO8859P15, WE8ISO8859P9, WE8MACROMAN8S, WE8MSWIN1252, WE8NCR4970, WE8NEXTSTEP, WE8PC850, WE8PC858, WE8PC860, WE8ROMAN8, ZHS16CGB231280, ZHS16GBK, ZHS32GB18030, ZHT16BIG5, ZHT16CCDC, ZHT16HKSCS, ZHT16HKSCS31, ZHT16MSWIN950, ZHT32EUC, ZHT32TRIS.

The target character set is always Unicode and UTF-8 format.

== Runtime architecture

=== Modes of operation

To make redo log parsing possible -- OpenLogReplicator must be able to physically access redo log files. It is up to the user to make that possible. You can run OpenLogReplicator on the same host as the database or on another host.

==== OpenLogReplicator running on database host

This is the easiest solution. But it is not recommended for production systems. For this scenario you can run OpenLogReplicator on the same host as the database. In this scenario you can use any mode of operation.

Please mind that OpenLogReplicator may be using extensively memory and CPU. Please make sure that there are enough resources for the database to work properly.

==== OpenLogReplicator running on another host

This is the recommended solution. For this scenario you must make sure that the redo log files are possible to read. This may be achieved by:

* mounting read only remote filesystem (for example using SSHFS),

* reading from SRDF copy,

* reading from standby database,

* reading just archived redo logs copied by batch file;

.Remote access to redo log files
image:architecture-sshfs.png[Remote access to redo log files,,,]

OpenLogReplicator by default would read online redo logs and process transactions as soon as they are committed and this information is written to redo log. But it can also read just archived redo logs – in this scenario transactions would be processed when log switch is performed and redo log is archived.
